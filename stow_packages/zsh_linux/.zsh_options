# case insensitive globbing:
setopt NO_CASE_GLOB

# History file follows ZDOTDIR; consider moving to XDG state dir
HISTFILE=${HISTFILE:-${ZDOTDIR:-$HOME}/.zsh_history}  # save shell history when shell exits
HISTSIZE=500000
SAVEHIST=500000

# History quality
setopt SHARE_HISTORY                             # share history across multiple zsh sessions
setopt APPEND_HISTORY                            # append to history
setopt INC_APPEND_HISTORY                        # adds commands as they are typed, not at shell exit
setopt HIST_EXPIRE_DUPS_FIRST                    # expire duplicates first
setopt HIST_IGNORE_DUPS                          # do not store duplications
setopt HIST_FIND_NO_DUPS                         # ignore duplicates when searching
setopt HIST_REDUCE_BLANKS                        # removes blank lines from history
setopt CORRECT                                   # CORRECT corrects commands only
unsetopt CORRECT_ALL                             # CORRECT_ALL corrects commands AND arguments
setopt HIST_VERIFY                               # don't execute expanded history lines immediately
setopt EXTENDED_HISTORY                          # timestamps and runtime
setopt HIST_SAVE_NO_DUPS                         # don't write dupes
setopt HIST_IGNORE_ALL_DUPS                      # remove older dupes
setopt HIST_IGNORE_SPACE                         # ignore commands starting with a space


# Reliability / UX
setopt PIPEFAIL                                  # fail pipelines on first failing command
# setopt NO_BEEP
setopt INTERACTIVE_COMMENTS                      # allow # comments at prompt
setopt AUTO_CD                                   # `..` -> cd ..
setopt AUTO_PUSHD PUSHD_IGNORE_DUPS PUSHD_SILENT
#setopt NO_CLOBBER                                # prevent > from clobbering files; use >| to force
setopt NUMERIC_GLOB_SORT                         # sort numbers naturally


##
## Advanced zsh completions
# Disabling this because we generate the auto-complete cache manually in .zshrc
# https://scriptingosx.com/2019/07/moving-to-zsh-part-5-completions/
##<!-- autoload -Uz compinit && compinit -->

##
# Case-insensitive + fragment/substring matching (locale-aware)
zstyle ':completion:*' matcher-list \
    'm:{[:lower:][:upper:]}={[:upper:][:lower:]}' \
    'm:{[:lower:][:upper:]}={[:upper:][:lower:]} l:|=* r:|=*'

##
## Partial completion suggestions
#
# This is a particularly nice feature. You can type fragments of each path segment and the
# completion will try to complete them all at once:
#
# % cd /u/lo/bâ‡¥
# % cd /usr/local/bin
zstyle ':completion:*' list-suffixes yes
zstyle ':completion:*' expand prefix suffix

# Completion UX
zstyle ':completion:*' menu select
zstyle ':completion:*' group-name ''
zstyle ':completion:*:descriptions' format '%F{cyan}%B%d%b%f'
zstyle ':completion:*' list-colors "${(s.:.)LS_COLORS}"

# Cache completion results (writes under $XDG_CACHE_HOME/zsh by default)
zstyle ':completion:*' use-cache on
zstyle ':completion:*' cache-path "${XDG_CACHE_HOME:-$HOME/.cache}/zsh"

# Ensure complist for menu-select UI is available
zmodload -i zsh/complist